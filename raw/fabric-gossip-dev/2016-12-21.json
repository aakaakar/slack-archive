[
    {
        "user": "U2P0N5J5A",
        "text": "<@U2P0N5J5A|sergefdrv> has joined the channel",
        "type": "message",
        "subtype": "channel_join",
        "ts": "1482313229.000320"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "<@U0XPR4NP4>  ,  so, I wanted to validate something regarding configuration transactions and ordering service",
        "ts": "1482331667.000321"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "When I get a block from the ordering service, can I use only the MSP to verify it?",
        "ts": "1482331686.000322"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "assuming the MSP is \"up-to-date\" with the ledger's data",
        "ts": "1482331698.000323"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Correct",
        "ts": "1482331721.000324"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "If you have the previous configuration block, you can validate it",
        "ts": "1482331731.000325"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "But the validation is ONLY with using the MSP right?",
        "ts": "1482331756.000326"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "(So, in general, if you have all blocks prior to this one, you can prove that you have the last configuration block)",
        "ts": "1482331756.000327"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "there is no other entity in the peer",
        "ts": "1482331761.000328"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "that does that",
        "ts": "1482331763.000329"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I mean- the number of signers of the multi-sig it's all in the MSP too right?",
        "ts": "1482331776.000330"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Well, there are policies embedded in the configuration, which are not in the MSP",
        "ts": "1482331794.000331"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "such as?",
        "ts": "1482331802.000332"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Every configuration item has a modification policy",
        "ts": "1482331819.000333"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "These policies can either be an MSP type policy, or a recursive \"n out of signature policy\"",
        "ts": "1482331839.000334"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "The MSP ones are embedded within the MSP, but for cross MSP multi-sig stuff, that doesn't make any sense",
        "ts": "1482331853.000335"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Otherwise whoever controlled the MSP that policy was in would control the network",
        "ts": "1482331875.000336"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "how are blocks cross-MSP?",
        "ts": "1482331882.000337"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "an MSP is per channel and so is a block",
        "ts": "1482331890.000338"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "OK you know what, maybe I can get to the bottom line what I'm \"trying to do here\"",
        "ts": "1482331904.000339"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "and that will help you understand what I want",
        "ts": "1482331912.000340"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Ah, no, not at all",
        "ts": "1482331930.000341"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "There are multiple MSPs per chain",
        "ts": "1482331940.000342"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "One MSP per organization participating in the chain",
        "ts": "1482331950.000343"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "oh yeah",
        "ts": "1482331955.000344"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I meant that this aggregation is per channel",
        "ts": "1482331963.000345"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "But sure, get to the bottom line",
        "ts": "1482331965.000346"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "channel --&gt; [] MSP",
        "ts": "1482331974.000347"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "in any case",
        "ts": "1482331979.000348"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "In gossip we select a leader that connects to the ordering service on behalf of all channels of the org",
        "ts": "1482331998.000349"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "that leader isn't always, obviously in the channel itself",
        "ts": "1482332009.000350"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "So, one could ask a question- how does that leader \"trust\" the blocks it receives, etc.",
        "ts": "1482332033.000351"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "So I thought we could leverage the fact that the peers in gossip would replicate the MSPs in the organization",
        "ts": "1482332059.000352"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "meaning- if we have an org O1 and it has 3 channels, all peers of that channel would replicate the MSPs of the channel to all peers of O1",
        "ts": "1482332080.000353"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "the leader is selected from O1 so it can verify the blocks using the MSP.",
        "ts": "1482332094.000354"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "So I wanted to ask, if there is something I'm missing here, any data that that peer is missing because that data is not in the MSP",
        "ts": "1482332111.000355"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "So trust is very easy.  The leader starts with a configuration block.  It then receives blocks in order from the ordering service after this point.",
        "ts": "1482332257.000356"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "wait wait",
        "ts": "1482332268.000357"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "the leader doesn't have the ledger",
        "ts": "1482332272.000358"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I'm looking at the worst case",
        "ts": "1482332278.000359"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "in which the leader is not part of the channel itself",
        "ts": "1482332284.000360"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "just in that org",
        "ts": "1482332287.000361"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "it just has the MSP because I artificially replicate it",
        "ts": "1482332300.000362"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "I maintain, the only way to connect to a channel\/chain is to start with its configuration block",
        "ts": "1482332330.000363"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "oh? why is that?",
        "ts": "1482332342.000364"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Otherwise you don't know who the orderers are, what the block validation policy is for that chain, or potentially even simpler things like how to verify hashes on a block",
        "ts": "1482332390.000365"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "wait",
        "ts": "1482332397.000366"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I thought in V1 the orderes are the same",
        "ts": "1482332402.000367"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "how to verify hashes- what do you mean? you mean hash chain verification?",
        "ts": "1482332423.000368"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I don't need to know that as the leader, I just want to verify the signatures on the block, I think... isn't it enough?",
        "ts": "1482332453.000369"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Some of these things may be static in v1, but it makes sense that we would define the hashing algorithms etc. in the chain configuration block",
        "ts": "1482332454.000370"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "In v1 the orderers are the same, but if you're building the system based on this assumption, I think it's the wrong architecture",
        "ts": "1482332485.000371"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I understand the hashing part but I don't need to verify it as the leader",
        "ts": "1482332487.000372"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "You have to",
        "ts": "1482332497.000373"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "why?",
        "ts": "1482332499.000374"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "You're checking the signature over the block",
        "ts": "1482332522.000375"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Over the block header",
        "ts": "1482332528.000376"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "The block header contains the hash of the block data",
        "ts": "1482332538.000377"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "So, checking the signature of the block header does nothing for you, unless you also check that the block data accompanying it is for that block header",
        "ts": "1482332569.000378"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "oh so I need to hash",
        "ts": "1482332569.000379"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "and to verify the sig on the hash",
        "ts": "1482332574.000380"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "?",
        "ts": "1482332589.000381"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "The signature might include its own hashing algorithm, which is fine",
        "ts": "1482332599.000382"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "But the hash of the block data needs to be checked",
        "ts": "1482332612.000383"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "So hear my proposal out.",
        "ts": "1482332622.000384"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "ok",
        "ts": "1482332626.000385"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "When the 'leader' is told to join a chain, it should be supplied with a configuration block for that chain.  The leader can process this block with zero ledger requirement.  It now has a list of all the MSPs for that chain, policies etc.",
        "ts": "1482332672.000386"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Then it retrieves blocks from the ordering service in order from that point forwards.  It does cursory validation, and in particular checks to see if it's a new configuration block.",
        "ts": "1482332697.000387"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "can the hash algo change?",
        "ts": "1482332699.000388"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "during the chain",
        "ts": "1482332705.000389"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "If it is a new configuration block, then it processes it just like it did the first time, and proceeds.",
        "ts": "1482332717.000390"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "I don't know that it's a technical requirement for v1, but imagining a chain which lives for 30 years, I'd imagine the hashing algorithm would have to change eventually",
        "edited": {
            "user": "U0XPR4NP4",
            "ts": "1482332830.000000"
        },
        "ts": "1482332738.000391"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "(Nothing we need to explicitly support in v1 is what I'm getting at, just don't want to back us into a corner where we can never support it)",
        "ts": "1482332763.000392"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "But Jason",
        "ts": "1482332831.000394"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "the leader doesn't get the JoinChannel message",
        "ts": "1482332841.000395"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "currently, at least",
        "ts": "1482332845.000396"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "so, let me ask you this",
        "ts": "1482332856.000397"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "what do we need from the genesis block",
        "ts": "1482332863.000398"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "apart from the hash algo?",
        "ts": "1482332867.000399"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Hold on, back in 20 minutes or so, have a tow truck outside",
        "ts": "1482332918.000400"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "sure np",
        "ts": "1482332926.000401"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "and thanks",
        "ts": "1482332930.000402"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "<@U0ULK2JPP>  feel free to ask what you wanted here",
        "ts": "1482332943.000403"
    },
    {
        "type": "message",
        "user": "U0ULK2JPP",
        "text": "<@U0XPR4NP4> I was asking about validations \u2026 but let me read first",
        "ts": "1482333068.000404"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "<@U0XPR4NP4> , If we could have encapsulated the hash algorithm in the MSP our problem would've been solved. Right?\n<@U1BC5A0F9>  Does the MSP configuration has any generic field that can be used to store some arbitrary small byte slice? \nWe have a certain problem that Jason raised, which is that the MSP alone isn't enough to validate a block received from the ordering service, we need some more info that is stored in the genesis block.",
        "edited": {
            "user": "U0ZJZBJLF",
            "ts": "1482334631.000000"
        },
        "ts": "1482334610.000405"
    },
    {
        "type": "message",
        "user": "U1BC5A0F9",
        "text": "you mean what hash algorithm is used for what?",
        "ts": "1482334882.000407"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "<@U1BC5A0F9> <@U0ULK2JPP> We've had discussions about how we want to do the hashing of the block data, whether it is Merkle tree or flat for instance",
        "ts": "1482335036.000408"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "So, to give ourselves flexibility, we might want to encode which hashing scheme we are using for the chain into the configuration block",
        "ts": "1482335054.000409"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "But I maintain, that you _must_ process every configuration block if you are a subscriber to a chain, including this gossip proxy process",
        "ts": "1482335108.000410"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "And I'm not really sure why this is that onerous, the proxy is receiving the stream of blocks, the configuration blocks should be very infrequent, and you do not need to retain anything except for the contents of the most recent configuration block",
        "ts": "1482335145.000411"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "There is no ledger required, seems quite straight forward to me, not sure what I am missing",
        "ts": "1482335157.000412"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "why including, Jason?",
        "ts": "1482335274.000413"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I thought we talked about that hack with the last config block?",
        "ts": "1482335294.000414"
    },
    {
        "type": "message",
        "user": "U1HFNJB50",
        "text": "Isn't last configuration block part of block metadata?",
        "ts": "1482335337.000415"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "The index of the last configuration block can be part of the metadata",
        "ts": "1482335502.000416"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "But that's not foolproof, we discussed that extensively",
        "ts": "1482335522.000417"
    },
    {
        "type": "message",
        "user": "U1HFNJB50",
        "text": "Well, I was pretty sure it will be part of the metadata",
        "ts": "1482335525.000418"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Yes, it's not there yet, is all I meant to say",
        "ts": "1482335541.000419"
    },
    {
        "type": "message",
        "user": "U1HFNJB50",
        "text": "k",
        "ts": "1482335547.000420"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "Well, it's not foolproof but the leader only disseminates",
        "ts": "1482335554.000421"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "But I go back to \"Why not?\" The leader will be seeing the whole chain in order.",
        "ts": "1482335578.000422"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "It seems far simpler to simply parse the configuration when it arrives",
        "ts": "1482335587.000423"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Than to try to invent some other more clever scheme",
        "ts": "1482335595.000424"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "yeah I agree here",
        "ts": "1482335603.000425"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "but how can we do that?",
        "ts": "1482335606.000426"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Ah, that's actually quite easy",
        "ts": "1482335613.000427"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I mean- we'll have to persist that",
        "ts": "1482335616.000428"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "won't we?",
        "ts": "1482335617.000429"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "In order to support restarting, yes",
        "ts": "1482335630.000430"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "But it's just one block, should not be a big deal I would think?",
        "ts": "1482335641.000431"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "Wait, so the configuration block contains all the data I need?",
        "ts": "1482335686.000432"
    },
    {
        "type": "message",
        "user": "U1BC5A0F9",
        "text": "hm but <@U0XPR4NP4> don;t you guys have a chicken and egg problem?",
        "ts": "1482335688.000433"
    },
    {
        "type": "message",
        "user": "U1HFNJB50",
        "text": "I think there is a hard requirement that peer which not part of the channel should not process blocks",
        "ts": "1482335689.000434"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "not just \"updates\" for that?",
        "ts": "1482335689.000435"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "<@U0ZJZBJLF> Correct, the configuration block is all you need",
        "edited": {
            "user": "U0XPR4NP4",
            "ts": "1482335702.000000"
        },
        "ts": "1482335698.000436"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "it always contains all the data?",
        "ts": "1482335708.000438"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Correct",
        "ts": "1482335715.000439"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "Wait",
        "ts": "1482335725.000440"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "if I'm a leader and I join a channel",
        "ts": "1482335732.000441"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I don't have the latest config",
        "ts": "1482335737.000442"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I mean, not join a channel",
        "ts": "1482335746.000443"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "If I'm a leader and I'm suddenly told by a peer to grab blocks for a channel I'm not a member of",
        "ts": "1482335773.000444"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I don't have the last config block",
        "ts": "1482335781.000445"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "But let's look at the full flow",
        "ts": "1482335810.000446"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Why did that peer make that call?",
        "ts": "1482335825.000447"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Presumably, because someone called `JoinChain` on him",
        "ts": "1482335835.000448"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Which means he has the genesis\/configuration block for that chain",
        "ts": "1482335843.000449"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "So he can just hand it in with his request.",
        "ts": "1482335849.000450"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Then there's no more problem?",
        "ts": "1482335864.000451"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "It has the genesis but it doesn't have the latest",
        "ts": "1482335924.000452"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I just want to make sure you have a clear image of what we do",
        "ts": "1482335941.000453"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "we have peers of a channel, and a leader that's also a peer and in the worst case scenario it is not part of the channel and doesn't get the Joinchannel message",
        "ts": "1482335962.000454"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "But it does request blocks from the orderer by hearing messages from the channel peers that only contain (more or less) the chainID",
        "ts": "1482335990.000455"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "(and the ledger height)",
        "ts": "1482335996.000456"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "So it connects to the orderer and asks for blocks for the peers and disseminates to the channel peers",
        "ts": "1482336020.000457"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I just want to verify the signature in the leader peer.  Now, we have some time period in which the latest MSP isn't replicated to the leader",
        "ts": "1482336057.000458"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "but that's ok",
        "ts": "1482336059.000459"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "because it's a pretty short time frame",
        "ts": "1482336065.000460"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "So I just need all the data I need in order to verify these blocks.",
        "ts": "1482336098.000461"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "<@U1BC5A0F9>  what chicken and egg problem?",
        "ts": "1482336115.000462"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "I maintain, that without the configuration block, you can't verify these blocks.  You could make some handwavy assumptions about how the block validation policy is the same across chains because it's all coming from the same ordering service, but that seems like the wrong way to go about things to me.",
        "edited": {
            "user": "U0XPR4NP4",
            "ts": "1482336196.000000"
        },
        "ts": "1482336181.000463"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "Yeah, so I also need that BVP, and the hash algo. Anything else?",
        "ts": "1482336227.000465"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "In particular, when the network changes, you're going to have different states across all these chains momentarily",
        "ts": "1482336233.000466"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "what do you mean when the network changes? when the orderers change?",
        "ts": "1482336271.000467"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Sure, that's one possibility.  Let's say that an orderer is kicked out and a new one brought in.",
        "ts": "1482336306.000468"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "but in V1 it's the same for everyone",
        "ts": "1482336333.000469"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Then you're going to have a situation where on some `Deliver` calls, one set of signatures is valid",
        "ts": "1482336334.000470"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "So eventually",
        "ts": "1482336340.000471"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "No, definitely not",
        "ts": "1482336340.000472"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "huh?",
        "ts": "1482336346.000473"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "In order to prevent non-determinism, chain configuration _must_ change on a per chain basis, it cannot change globally",
        "ts": "1482336366.000474"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "This is something that <@U1BC5A0F9> first noted, and it's very true",
        "ts": "1482336379.000475"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "So even if you want to kick an orderer out from all the chains",
        "ts": "1482336403.000476"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "You have to do it on a per chain basis",
        "ts": "1482336411.000477"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "ok",
        "ts": "1482336415.000478"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "so continue with your scenario",
        "ts": "1482336420.000479"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Which means you will have multiple chains, each with a different set of orderers",
        "ts": "1482336422.000480"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "an orderer is kicked and some other orderer is brought it",
        "ts": "1482336438.000481"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I'm the leader peer, and I just grab the blocks, and disseminate them. \nOh. you mean- that I happen to connect to a byzantine orderer",
        "ts": "1482336462.000482"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "and then I'll disseminate blocks that are fake",
        "ts": "1482336474.000483"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "and I will never know it",
        "ts": "1482336478.000484"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "something like that?",
        "ts": "1482336480.000485"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "I mean that, you cannot rely on the orderer configuration being consistent across chains",
        "ts": "1482336496.000486"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Let's say that you have two chains",
        "ts": "1482336516.000487"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "And one of them is very high volume, so high volume, your deliver call is lagging by a few thousand blocks",
        "ts": "1482336532.000488"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "The other chain gets a reconfiguration message which completely evicts the entire set of orderers, and adds new ones (one would hope this scenario doesn't happen, but it's easier to demonstrate)",
        "ts": "1482336566.000489"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "The deliver call on the high volume chain is getting back signatures from those evicted orderers, and that's just fine, those blocks are still valid, because that chain is lagging",
        "ts": "1482336596.000490"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "You will not see the new orderer signatures until you process the configuration block which evicts the old ones.",
        "ts": "1482336614.000491"
    },
    {
        "type": "message",
        "user": "U1HFNJB50",
        "text": "Could you please ellaborate how this flow actually works? I mean how you completely evicts all orderers?",
        "ts": "1482336635.000492"
    },
    {
        "type": "message",
        "user": "U1HFNJB50",
        "text": "This is should be a transaction which passes the ordering service",
        "ts": "1482336650.000493"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Correct",
        "ts": "1482336657.000494"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "This is a configuration transaction",
        "ts": "1482336661.000495"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "This type of transaction can't happen",
        "ts": "1482336682.000496"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Why not?",
        "ts": "1482336689.000497"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "if you lose connection to the ordering service you're locked outside of your house",
        "ts": "1482336696.000498"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Imagine this isn't a change for byzantine behavior",
        "ts": "1482336714.000499"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Imagine this is just a change for system maintenance",
        "ts": "1482336726.000500"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "You're closing down the Raleigh datacenter, and moving the orderers to Austin",
        "ts": "1482336740.000501"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "But if you have a peer that didn't have enough time to receive this block, and you did the change, it's disconnected from the orderer for ever",
        "ts": "1482336751.000502"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "So, you submit a reconfiguration transaction which switches all of the orderers to be in Austin, and that's the last thing you submit to the Raleigh ones, they process it normally, and deliver it to everyone.  After a few weeks, once you're confident everyone is no longer on the Raleigh servers, you shut them down.",
        "ts": "1482336793.000503"
    },
    {
        "type": "message",
        "user": "U1HFNJB50",
        "text": "<https:\/\/www.stihi.ru\/pics\/2011\/11\/13\/6955.jpg>",
        "attachments": [
            {
                "fallback": "399x271px image",
                "image_url": "https:\/\/www.stihi.ru\/pics\/2011\/11\/13\/6955.jpg",
                "image_width": 399,
                "image_height": 271,
                "image_bytes": 18250,
                "from_url": "https:\/\/www.stihi.ru\/pics\/2011\/11\/13\/6955.jpg",
                "id": 1
            }
        ],
        "ts": "1482336804.000504"
    },
    {
        "type": "message",
        "user": "U1HFNJB50",
        "text": "make such transaction feel to me like this",
        "ts": "1482336820.000506"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "I agree in practice, you would probably do this incrementally, but there is no technical reason this could not happen",
        "ts": "1482336859.000507"
    },
    {
        "type": "message",
        "user": "U1HFNJB50",
        "text": "&gt; You're closing down the Raleigh datacenter, and moving the orderers to Austin\n\nI guess this suppose to happen gradually, e.g. add orderers from Austin and then evict those from RTP",
        "ts": "1482336879.000508"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Right, I would think this is how it would be done in practice",
        "ts": "1482336897.000509"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "So can you continue describing the attack?",
        "ts": "1482336910.000510"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "The key point in the attack vector",
        "ts": "1482336919.000511"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "is that different chains process configuration blocks in different times",
        "edited": {
            "user": "U0ZJZBJLF",
            "ts": "1482336951.000000"
        },
        "ts": "1482336930.000512"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "right?",
        "ts": "1482336931.000513"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Right",
        "ts": "1482336935.000514"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "What's the attack?",
        "ts": "1482336943.000515"
    },
    {
        "type": "message",
        "user": "U1HFNJB50",
        "text": "Also I'm not truely following that you are trying to say here:\n&gt;I mean that, you cannot rely on the orderer configuration being consistent across chains\nIt technically possible that each chain has its own ordering service",
        "ts": "1482337028.000517"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "It's less of an attack, and more of a lack of correctness.  If you take the most recent orderer set and use that for your validation.  Then you will get stuck, because in the scenario I described, the signatures on the blocks are from the old set of orderers, and you'll think they are invalid, but they are valid.  So, you'll think the ordering service is giving you garbage, but it's not.",
        "ts": "1482337137.000518"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "&gt; It technically possible that each chain has its own ordering service\n\nIt's absolutely technically possible.  And, since orderer reconfiguration is necessarily processed per chain, there will always be a window when even to the same ordering service, different chains have different views of what a valid block from the ordering service is.",
        "ts": "1482337189.000519"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "oh yeah I'm aware that I'll get stuck",
        "ts": "1482337230.000520"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "but only for a time",
        "ts": "1482337233.000521"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Why only for a time?",
        "ts": "1482337238.000522"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "because the peers of the channel did process the transactions in order",
        "ts": "1482337256.000523"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "will eventually update me, the leader",
        "ts": "1482337262.000524"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "for the right data",
        "ts": "1482337266.000525"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Hold on",
        "ts": "1482337268.000526"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "holding",
        "ts": "1482337272.000527"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "The peers of the channel are getting the new blocks from you, no?",
        "ts": "1482337278.000528"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "yeah",
        "ts": "1482337281.000529"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Then if you're stuck...",
        "ts": "1482337285.000530"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "How do they get the new blocks?",
        "ts": "1482337291.000531"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "ok let's say my latest block I sent to them was `i` ok?",
        "ts": "1482337316.000532"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "now I'm stuck",
        "ts": "1482337322.000533"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "if I had the ledger how would I continue?",
        "ts": "1482337332.000534"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I would have processed all blocks until `i`, applied the configuration to the orderer client",
        "ts": "1482337344.000535"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "and then continued",
        "ts": "1482337347.000536"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "this information would have gossiped to me by the channel's peers",
        "ts": "1482337358.000537"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "so I get the latest config I need and then I continue with the right policies, etc etc",
        "ts": "1482337374.000538"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "I think this is a different scenario, let's go back to my silly high volume one",
        "ts": "1482337385.000539"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "sure",
        "ts": "1482337389.000540"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Two chains, chain A, chain B",
        "ts": "1482337393.000541"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "yeah",
        "ts": "1482337396.000542"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "chain A is high volume",
        "ts": "1482337397.000543"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "chain B is low volume",
        "ts": "1482337403.000544"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "we are at block `i_a` in chain A, and block `i_b` in chain B",
        "ts": "1482337426.000545"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "The orderer configuration changes at block `i_b+1` and block `i_a+10000`",
        "ts": "1482337456.000546"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "The network processing chain B block `i_b+1` and realizes that the orderer set has changed",
        "ts": "1482337491.000547"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Via whatever gossip mechanism, this information gets propagated to the special ~(anchor?)~ leader peer which does the actual `Deliver` call for all the chains.",
        "edited": {
            "user": "U0XPR4NP4",
            "ts": "1482337567.000000"
        },
        "ts": "1482337527.000548"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "(not anchor. leader!)",
        "ts": "1482337554.000549"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Great, otherwise are we on the same page thusfar?",
        "ts": "1482337595.000553"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "yeah",
        "ts": "1482337619.000554"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Okay, so, now, the `Deliver` call sends back block `i_a+1` on Chain A, and it has the signatures from the old set of orderers",
        "ts": "1482337647.000555"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "So, the leader peer is going to reject this block as non-validating, because it heard via Chain B that the orderer set changed.",
        "ts": "1482337678.000556"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "no no",
        "ts": "1482337692.000557"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "it validates only with the MSP of its channel",
        "ts": "1482337701.000558"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "with channel A, that is",
        "ts": "1482337722.000559"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "But MSPs don't do block validation, and there are multiple MSPs per chain",
        "ts": "1482337722.000560"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "How come they don't do that? who does that then?",
        "ts": "1482337749.000561"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I thought they do...",
        "ts": "1482337753.000562"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "don't they check the signature?",
        "ts": "1482337762.000563"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "MSPs are capable of verify a signature",
        "ts": "1482337778.000564"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "They also have a policy provider that can verify a signature set",
        "ts": "1482337789.000565"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "can't they verify a multi sig also?",
        "ts": "1482337793.000566"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "But there are other policy providers",
        "ts": "1482337797.000567"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Namely the `cauthdsl` policy provider, which is what has to be used whenever there is a policy which crosses MSP boundaries",
        "ts": "1482337812.000568"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "And, for block validation, the policy may cross MSP boundaries (in the BFT case it definitely does), so this policy will usually be a `cauthdsl` one",
        "ts": "1482337842.000569"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "ok I see what you mean, so basically if I could store all the information I needed to validate *per channel* in the MSP",
        "ts": "1482337846.000570"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "and then to verify *per channel* with that info",
        "ts": "1482337858.000571"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "that would've solved the problem",
        "ts": "1482337867.000572"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Yes, you need to store this information per chain.  Though I think you are a little fixated on the MSP, which does not contain everything you need, as the block validation policy may live outside of an MSP",
        "ts": "1482337904.000573"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "All policies require the MSPs for the last step of validation, however, policies do not need to live within MSPs",
        "ts": "1482337936.000574"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I can either replicate it by putting it somehow in the MSP if it is allowed, or build something that contains both the MSP and these  stuff and *then* replicate it",
        "ts": "1482337945.000575"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "per-channel, of course",
        "ts": "1482337950.000576"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Which sounds a lot like the configuration block to me...",
        "ts": "1482337984.000577"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "Can an MSP be recreated completely from scratch",
        "ts": "1482338005.000578"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "from the conf. block?",
        "ts": "1482338008.000579"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "I guess it can, from the genesis block",
        "ts": "1482338046.000580"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "is it also for a conf. block?",
        "ts": "1482338053.000581"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Right",
        "ts": "1482338071.000582"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Genesis block is a configuration block, just the first one",
        "ts": "1482338085.000583"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "oh. good to know",
        "ts": "1482338102.000584"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "The configuration block contains a configuration transaction, which contains absolutely all of the config for the chain.  No incremental building, or deltas.  They are stateless with respect to their application (though their validation obviously requires the previous config)",
        "edited": {
            "user": "U0XPR4NP4",
            "ts": "1482338153.000000"
        },
        "ts": "1482338132.000585"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "perhaps I should have talked to you before opening <https:\/\/jira.hyperledger.org\/browse\/FAB-1459>",
        "ts": "1482338164.000587"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "So... if we could simply replicate the configuration blocks that would've solved the problem, I guess.",
        "ts": "1482338222.000588"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Yep, looks like it",
        "ts": "1482338252.000589"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "<@U1BC5A0F9>  what do you think?",
        "ts": "1482338259.000590"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "Is it light weight?",
        "ts": "1482338295.000591"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "the conf. block?",
        "ts": "1482338299.000592"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "(Jason) ^",
        "ts": "1482338311.000593"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "I expect for the bulk of the 'weight' to be the MSP definitions.",
        "ts": "1482338384.000594"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "(And the bulk of that weight to come from the certificates)",
        "ts": "1482338431.000595"
    },
    {
        "type": "message",
        "user": "U0ZJZBJLF",
        "text": "Makes sense. All right, thanks a lot Jason! \nYou have a knack of pointing at problems we don't see because we don't know the full picture...",
        "ts": "1482338573.000596"
    },
    {
        "type": "message",
        "user": "U0XPR4NP4",
        "text": "Thanks! Happy to help! Hopefully my world view isn't too orderer myopic, and hopefully <@U1BC5A0F9> can confirm some of what I've said",
        "ts": "1482338648.000597"
    }
]