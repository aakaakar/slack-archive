<html><body><style>
			* {
				font-family:sans-serif;
			}
			body {
				text-align:center;
				padding:1em;
			}
			.messages {
				width:100%;
				max-width:700px;
				text-align:left;
				display:inline-block;
			}
			.messages img {
				background-color:rgb(248,244,240);
				width:36px;
				height:36px;
				border-radius:0.2em;
				display:inline-block;
				vertical-align:top;
				margin-right:0.65em;
			}
			.messages .time {
				display:inline-block;
				color:rgb(200,200,200);
				margin-left:0.5em;
			}
			.messages .username {
				display:inline-block;
				font-weight:600;
				line-height:1;
			}
			.messages .message {
				display:inline-block;
				vertical-align:top;
				line-height:1;
				width:calc(100% - 3em);
			}
			.messages .message .msg {
				line-height:1.5;
			}
		</style><div class="messages"><div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 14:50</div><div class="msg">has joined #deploy-model-sec</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 14:50</div><div class="msg">@elli set the channel purpose: Discuss potential security concerns of the new deployment model</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/f2f14ee3d0f083c9afce9767faf6322d.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0000-72.png" /><div class="message"><div class="username">muralisr</div><div class="time">2017-02-02 14:50</div><div class="msg">has joined #deploy-model-sec</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2016-07-21/61823221170_e0795e87fc9eb0abb221_72.jpg" /><div class="message"><div class="username">adc</div><div class="time">2017-02-02 14:50</div><div class="msg">has joined #deploy-model-sec</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/12c90da30ab8bfed856055ae03e5fbde.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0010-72.png" /><div class="message"><div class="username">mneug</div><div class="time">2017-02-02 14:50</div><div class="msg">has joined #deploy-model-sec</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/157b7453a8619d0392f489734c550f92.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0002-72.png" /><div class="message"><div class="username">aso</div><div class="time">2017-02-02 14:50</div><div class="msg">has joined #deploy-model-sec</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/86e916316f8f43753820061057afa6b4.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0004-72.png" /><div class="message"><div class="username">binhn</div><div class="time">2017-02-02 14:50</div><div class="msg">has joined #deploy-model-sec</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 14:51</div><div class="msg">Hi all, I created this channel to discuss security of the new deployment model</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 14:51</div><div class="msg">some background: @adc talked to @muralisr yesterday, and among others, there were two interesting points</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 14:53</div><div class="msg">1) that with the new model there is one container the chaincode runs in regardless of the chain this chaincode is running for; what changes is the context this chaincode is invoked for (an object referenced by the id of the transaction that invoked that chaincode txid )</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 14:59</div><div class="msg">2) that upon a chaincode invoking getState(key), the Shim retrieves the txid the invocation is connected to and sends to the peer a getState(key, txid) message that would enable the peer to retrieve the context the chaincode was invoked for (recall, it is referenced using the txid) and respond accordingly. From what @adc explained there is no strong binding between the connection a peer has with a chaincode and the txid (actual context that should follow that invocation)</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/f2f14ee3d0f083c9afce9767faf6322d.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0000-72.png" /><div class="message"><div class="username">muralisr</div><div class="time">2017-02-02 15:01</div><div class="msg">both correct Elli</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 15:03</div><div class="msg">also maybe a point 3) TLS connection between a chaincode and the peer is only peer-side authenticated</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/12c90da30ab8bfed856055ae03e5fbde.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0010-72.png" /><div class="message"><div class="username">mneug</div><div class="time">2017-02-02 15:10</div><div class="msg">so (1) weakens the isolation between chains by having one chaincode instance handle multiple chains. In the presence of an attacker that can compromise chaincode by invoking it, such an attacker would thus gain access to all chains that the chaincode is being used for.</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/12c90da30ab8bfed856055ae03e5fbde.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0010-72.png" /><div class="message"><div class="username">mneug</div><div class="time">2017-02-02 15:12</div><div class="msg">for (2) a compromised chaincode could just use any transaction ID (because it is not bound to its connection with the peer)</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 15:16</div><div class="msg">and in that case (2) if there are other chaincodes being invoked at the same time, as the compromised/malicious one, the latter could get other chain's chaincode's state</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 15:16</div><div class="msg">(?)</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/12c90da30ab8bfed856055ae03e5fbde.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0010-72.png" /><div class="message"><div class="username">mneug</div><div class="time">2017-02-02 15:20</div><div class="msg">so based on my understanding this could only happen if the benign chaincode's handler is unregistered for some reason and the malicious chaincode registers with the benign chaincode's ID. because the chaincode ID is bound to the handler/connection</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 15:22</div><div class="msg">Ok, So you are saying that apart from the txid that the chaincode / shim sends to the peer, the peer also checks the txid the connection is bound to prior to sending context (state) info to the chaincode (?)</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/12c90da30ab8bfed856055ae03e5fbde.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0010-72.png" /><div class="message"><div class="username">mneug</div><div class="time">2017-02-02 15:24</div><div class="msg">no, I don't think I said that :slightly_smiling_face:
I was merely referring to the chaincode ID</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 17:36</div><div class="msg">Ok, discussed with @mneug and arrived to the following conclusions (@mneug, please correct me if i m wrong):</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 17:40</div><div class="msg">a) When a chaincode is invoked or actually launched there the peer binds the connection to the container (handler) to the chaincode identifier. The peer also constructs a transaction context object, that is referenced by the transaction identifier and includes also chaincode identifier in it. Now, we should ensure that whenever the chaincode requests state "getState(txid, key)" or "setState(txid, key, value)" the peer needs to check that the txcontext object referenced by "txid" corresponds indeed to a chaincode with the same chaincode identifier as the one the connection is bound to.</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 17:40</div><div class="msg">Here we assumed that there is at most *one* instance of a given chaincode that is running on the peer at each time. @muralisr, please confirm that this is the case.</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 17:43</div><div class="msg">b) The same as what Matthias (@mneug) mentioned before: with the new deployment model the isolation between chains is weakened by having one chaincode instance handle multiple chains. In the presence of an attacker that can compromise chaincode by invoking it, such an attacker would thus gain access to all chains that the chaincode is being used for.</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/12c90da30ab8bfed856055ae03e5fbde.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0010-72.png" /><div class="message"><div class="username">mneug</div><div class="time">2017-02-02 17:49</div><div class="msg">@elli thanks a lot for the write-up! :slightly_smiling_face:</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/f2f14ee3d0f083c9afce9767faf6322d.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0000-72.png" /><div class="message"><div class="username">muralisr</div><div class="time">2017-02-02 17:51</div><div class="msg">Will read by today Elli (and thanks Matthias!)</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 17:51</div><div class="msg">c) The chaincodes are not authenticated in their connection to the peer. Meaning that the chaincode - peer connection is solely peer-side authenticated. This is *not a problem* for as long as the connection that the peer initiates for that chaincode is open. If for any reason the connection to more than one chaincodes is closed (unnexpectedly) the peer will try to re-connect to both chaincodes. Then because connections are not authenticated from the chaincode side, there is an ability of one chaincode to impersonate the other. This can be avoided if we have tls certificates inside the containers, and leverage mutual authentication.</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 17:51</div><div class="msg">@mneug, thank you for your time and advice !</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 17:52</div><div class="msg">@muralisr, at your convenience :slightly_smiling_face:</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-02 17:58</div><div class="msg">d) Finally, a note for us to check: is there a possibility for a malicious chaincode to impersonate another one before the connection of a peer to a freshly launched chaincode is established?</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/6d6c4b1b84399b8c273ddb847efc1177.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">ruslan</div><div class="time">2017-02-02 19:52</div><div class="msg">has joined #deploy-model-sec</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-03 16:17</div><div class="msg">Actually a note that (c) and (d) is not an attack that is new-model specific. It works also with the old model.</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8a94917afbdbd7e1bd944f484dc05cfe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0022-72.png" /><div class="message"><div class="username">elli</div><div class="time">2017-02-03 16:19</div><div class="msg">And another comment related to the new deployment model + the cc2cc query. Given that the callee may reside on another chain there can be inference attacks (using timing info) coming from the invoker for whether that other chaincode is currently busy or not.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2016-12-03/112352565781_af8a455dfc891821119c_72.jpg" /><div class="message"><div class="username">ry</div><div class="time">2017-02-07 23:26</div><div class="msg">has joined #deploy-model-sec</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2016-12-03/112352565781_af8a455dfc891821119c_72.jpg" /><div class="message"><div class="username">ry</div><div class="time">2017-02-07 23:26</div><div class="msg">please migrate to <a href="https://chat.hyperledger.org/">https://chat.hyperledger.org/</a></div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2016-12-03/112352565781_af8a455dfc891821119c_72.jpg" /><div class="message"><div class="username">ry</div><div class="time">2017-02-07 23:26</div><div class="msg">@ry archived the channel (w/ 8 members)</div></div></div><br/>
</div></body></html>